# ========== DATABASE ==========
# ‚ö†Ô∏è  CR√çTICO: Configura√ß√£o de banco DEPENDE DO PROFILE!
# - dev:  usa ${DB_DEV_NAME}  (quarkus_dev)  -> pode limpar
# - test: usa ${DB_TEST_NAME} (quarkus_test) -> limpa antes de testes
# - prod: usa ${DB_PROD_NAME} (quarkus_db)   -> NUNCA LIMPA!
#
# As configura√ß√µes espec√≠ficas est√£o em:
# - application-dev.properties  (development)
# - application-prod.properties (production)
# - src/test/resources/application.properties (test)

quarkus.datasource.db-kind=postgresql

# Valores padr√£o (sobrescritos por profile-specific configs)
quarkus.datasource.jdbc.url=${QUARKUS_DATASOURCE_JDBC_URL:jdbc:postgresql://localhost:5432/quarkus_dev}
quarkus.datasource.username=${QUARKUS_DATASOURCE_USERNAME:quarkus}
quarkus.datasource.password=${QUARKUS_DATASOURCE_PASSWORD:quarkus123}

# ========== HIBERNATE ORM ==========
# ?? MUDAN√áA CR√çTICA: Agora o Flyway controla o schema, n√£o o Hibernate!
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.log.sql=true

# ?? REMOVIDO: quarkus.hibernate-orm.sql-load-script (Flyway vai gerenciar)
# ?? REMOVIDO: quarkus.hibernate-orm.sql-load-script-phase (n√£o precisa mais)

# ========== FLYWAY ==========
# Executa migra√ß√µes automaticamente na inicializa√ß√£o
quarkus.flyway.migrate-at-start=true

# Cria a tabela flyway_schema_history se n√£o existir
quarkus.flyway.baseline-on-migrate=true

# Vers√£o inicial (√∫til se voc√™ j√° tem um banco com dados)
quarkus.flyway.baseline-version=0

# Localiza√ß√£o dos scripts de migra√ß√£o
quarkus.flyway.locations=db/migration

# Executa repair antes de migrar para corrigir checksums modificados
quarkus.flyway.repair-at-start=true

# ========== CONSOLE & LOGGING (DEV MODE) ==========
# Corre√ß√£o DEFINITIVA para NullPointerException no StartupLogCompressor
# DESABILITA o console interativo que causa o problema
quarkus.console.enabled=false

# Desabilita o console colorido/fancy que est√° causando problemas
quarkus.log.console.color=false

# Formato simples de log (sem status line interativo)
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n

# Aumenta o n√≠vel de log das categorias problem√°ticas para WARN (mais restritivo)
quarkus.log.category."io.quarkus.deployment.console".level=WARN
quarkus.log.category."io.quarkus.dev.console".level=WARN
quarkus.log.category."io.quarkus.bootstrap.classloading".level=WARN
quarkus.log.category."org.aesh".level=WARN

# Reduz o n√≠vel de log do Netty para evitar polui√ß√£o
quarkus.log.category."io.netty".level=INFO

# ========== CORS ==========
quarkus.http.cors=true
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,PUT,POST,DELETE,PATCH,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with

# ========== JWT SECURITY ==========
# Chaves RSA para assinatura e valida√ß√£o de tokens JWT
# üîí SEGURAN√áA: Chaves carregadas de arquivos locais (n√£o versionados no Git)
# A pasta security/ est√° protegida pelo .gitignore
# Cada ambiente (dev/staging/prod) deve ter suas pr√≥prias chaves
mp.jwt.verify.publickey.location=security/jwt-public.pem
mp.jwt.sign.key.location=security/jwt-private.pem

# Issuer do token (identificador √∫nico da API)
mp.jwt.verify.issuer=https://aguide.com.br
smallrye.jwt.sign.issuer=https://aguide.com.br

# Tempo de expira√ß√£o do token (em segundos)
# 3600 = 1 hora | 7200 = 2 horas | 86400 = 24 horas
jwt.expiration.time=${JWT_EXPIRATION_TIME:3600}

# Desabilita autentica√ß√£o HTTP Basic (usaremos JWT Bearer)
quarkus.http.auth.basic=false

# Path do security realm (opcional, mas recomendado)
quarkus.http.auth.permission.public.paths=/api/v1/auth/login,/api/v1/auth/register,/api/v1/auth/health,/q/*
quarkus.http.auth.permission.public.policy=permit

# Todos os outros endpoints requerem autentica√ß√£o JWT
quarkus.http.auth.permission.authenticated.paths=/*
quarkus.http.auth.permission.authenticated.policy=authenticated

# ========== CONFIGURA√á√ïES ESPEC√çFICAS DE AMBIENTE ==========
# As configura√ß√µes de HTTP, SSL e Flyway agora est√£o em:
#   - application-dev.properties  (desenvolvimento)
#   - application-prod.properties (produ√ß√£o)
#
# Para alternar entre ambientes, configure a vari√°vel:
#   QUARKUS_PROFILE=dev   ou   QUARKUS_PROFILE=prod
