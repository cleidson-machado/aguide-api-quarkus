# ========== CONFIGURAÇÕES DE TESTE ==========
# Este arquivo é carregado automaticamente quando @QuarkusTest executa

# ========== AUTENTICAÇÃO (DESABILITADA EM TESTES) ==========
# Desabilita o AuthenticationFilter para permitir testes sem token
quarkus.arc.exclude-types=br.com.aguideptbr.features.auth.AuthenticationFilter

# ========== JWT (DESABILITADO EM TESTES) ==========
# Desabilita a extensão SmallRye JWT completamente em testes
# Isso evita que tente carregar chaves públicas/privadas
quarkus.smallrye-jwt.enabled=false

# WORKAROUND: Mesmo com JWT desabilitado, o Quarkus valida a config
# Fornece valor dummy para evitar erro "property is required"
mp.jwt.sign.key-content=-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDUBQ==\n-----END PRIVATE KEY-----
mp.jwt.verify.publickey.location=META-INF/resources/publicKey.pem

# ========== HTTP (TEST) ==========
quarkus.http.port=8081
quarkus.http.test-port=8081

# ========== DATABASE (TEST) ==========
# Usa PostgreSQL com database dedicado para testes (usa mesmas credenciais de produção)
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=${QUARKUS_DATASOURCE_JDBC_URL:jdbc:postgresql://localhost:5432/quarkus_test}
quarkus.datasource.username=${QUARKUS_DATASOURCE_USERNAME:quarkus}
quarkus.datasource.password=${QUARKUS_DATASOURCE_PASSWORD:quarkus123}

# Pool de conexões otimizado para testes (evita timeout)
quarkus.datasource.jdbc.min-size=1
quarkus.datasource.jdbc.max-size=5
quarkus.datasource.jdbc.acquisition-timeout=10
quarkus.datasource.jdbc.idle-removal-interval=2M

# ========== FLYWAY (TEST) ==========
# Limpa e recria o banco a cada execução de teste
quarkus.flyway.clean-at-start=true
quarkus.flyway.migrate-at-start=true
# Usa as MESMAS migrations de produção (ambos ambientes usam PostgreSQL)
# Location padrão: classpath:db/migration (não precisa especificar)

# ========== HIBERNATE (TEST) ==========
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.log.sql=false

# ========== LOGS (TEST) ==========
quarkus.log.level=INFO
quarkus.log.console.enable=true
