# ========== CONFIGURAÇÕES DE TESTE ==========
# Este arquivo é carregado automaticamente quando @QuarkusTest executa

# ========== AUTENTICAÇÃO (DESABILITADA EM TESTES) ==========
# Desabilita o AuthenticationFilter para permitir testes sem token
quarkus.arc.exclude-types=br.com.aguideptbr.features.auth.AuthenticationFilter

# ========== JWT (DESABILITADO EM TESTES) ==========
# Desabilita a extensão SmallRye JWT completamente em testes
# Isso evita que tente carregar chaves públicas/privadas
quarkus.smallrye-jwt.enabled=false

# WORKAROUND: Mesmo com JWT desabilitado, o Quarkus valida a config
# Fornece valor dummy para evitar erro "property is required"
mp.jwt.sign.key-content=-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDUBQ==\n-----END PRIVATE KEY-----
mp.jwt.verify.publickey.location=META-INF/resources/publicKey.pem

# ========== HTTP (TEST) ==========
quarkus.http.port=8081
quarkus.http.test-port=8081

# ========== DATABASE (TEST) ==========
# Banco DEDICADO para testes - separado de dev e prod
# ✅ SEGURO limpar: não afeta quarkus_dev nem quarkus_db
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=jdbc:postgresql://${DB_TEST_HOST:localhost}:${DB_TEST_PORT:5432}/${DB_TEST_NAME:quarkus_test}
quarkus.datasource.username=${DB_TEST_USERNAME:quarkus}
quarkus.datasource.password=${DB_TEST_PASSWORD:quarkus123}

# Pool de conexões otimizado para testes (evita timeout)
quarkus.datasource.jdbc.min-size=1
quarkus.datasource.jdbc.max-size=5
quarkus.datasource.jdbc.acquisition-timeout=10
quarkus.datasource.jdbc.idle-removal-interval=2M

# ========== FLYWAY (TEST) ==========
# ✅ SEGURO: quarkus_test é banco dedicado para testes
# clean-at-start=false para evitar timeout/deadlock durante testes
# O banco é recriado via script externo antes dos testes (Jenkinsfile)
quarkus.flyway.clean-at-start=false
quarkus.flyway.migrate-at-start=true
quarkus.flyway.baseline-on-migrate=true
# Usa as MESMAS migrations de produção (PostgreSQL em todos ambientes)
# Location padrão: classpath:db/migration

# ========== HIBERNATE (TEST) ==========
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.log.sql=false

# ========== LOGS (TEST) ==========
# Modo SILENCIOSO: apenas erros críticos (TESTES LIMPOS como Jest/NestJS)
quarkus.log.level=ERROR
quarkus.log.console.enable=true
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] %s%e%n

# Seus logs da aplicação: WARN apenas (sem INFO/DEBUG)
quarkus.log.category."br.com.aguideptbr".level=WARN

# Hibernate: apenas ERROR
quarkus.log.category."org.hibernate".level=ERROR
quarkus.log.category."org.hibernate.SQL".level=ERROR
quarkus.log.category."org.hibernate.type.descriptor.sql.BasicBinder".level=ERROR
quarkus.log.category."org.hibernate.engine".level=ERROR
quarkus.log.category."org.hibernate.orm".level=ERROR

# Flyway: apenas ERROR
quarkus.log.category."org.flywaydb".level=ERROR

# Quarkus internals: apenas ERROR
quarkus.log.category."io.quarkus".level=ERROR
quarkus.log.category."io.smallrye".level=ERROR
quarkus.log.category."io.netty".level=ERROR

# PostgreSQL JDBC: apenas ERROR
quarkus.log.category."org.postgresql".level=ERROR

# JBoss Logging: apenas ERROR
quarkus.log.category."org.jboss".level=ERROR

# Vert.x: apenas ERROR
quarkus.log.category."io.vertx".level=ERROR

# Agroal (Connection Pool): apenas ERROR
quarkus.log.category."io.agroal".level=ERROR

# Narayana (JTA): apenas ERROR
quarkus.log.category."com.arjuna".level=ERROR
